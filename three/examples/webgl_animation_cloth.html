<!doctype html>
<html lang="en">
	<head>
		<title>three.js webgl - cloth simulation</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
		    body {
				font-family: Monospace;
				background-color: #000;
				color: #000;
				margin: 0px;
				overflow: hidden;
			}

            div{
            	display: block;
            }
            
            a {
				text-decoration: underline;
				cursor: pointer;
			}
			#info{
				position: absolute;
				padding: 10px;
				width: 100%;
				text-align: center;
			}
		</style>
	</head>
	<body>
		<div id="info">
			Simple Cloth Simulation<br/>
			Verlet integration with Constrains relaxation<br/>
			Toggle: <a onclick="rotate = !rotate;">Camera</a> |
			<a onclick="wind = !wind;">Wind</a> |
			<a onclick="sphere.visible = !sphere.visible;">Ball</a> |
			<a onclick="togglePins();">Pins</a>
		</div>
		<script src="../js/three.min.js"></script>

		<script src="../js/Detector.js"></script>
		<script src="../js/stats.min.js"></script>

		<!--<script src="../js/Cloth.js"></script>-->
		
		<script>
			
				/* testing cloth simulation */

			var pinsFormation = [];
			var pins = [6];

			pinsFormation.push( pins );

			pins = [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 ];
			pinsFormation.push( pins );

			pins = [ 0 ];
			pinsFormation.push( pins );

			pins = []; // cut the rope ;)
			pinsFormation.push( pins );

			//pins = [ 0, cloth.w ]; // classic 2 pins
			//pinsFormation.push( pins );

			pins = pinsFormation[ 1 ];


			function togglePins() {

				pins = pinsFormation[ ~~( Math.random() * pinsFormation.length ) ];

			}

			if ( ! Detector.webgl ) Detector.addGetWebGLMessage();
			//
			var container,stats;
			var camera,scene,renderer;
			
			var clothGeometry;
			var sphere;
			var object;
			var rotate=true;
			
			init();
			animate();
			function init(){
				container=document.createElement('div');
				document.body.appendChild(container);
				
				//scene
				scene=new THREE.Scene();
				scene.fog=new THREE.Fog(0xcce0ff,500,10000);
				//camera
				camera=new THREE.PerspectiveCamera(30,window.innerWidth/window.innerHeight,1,10000);
				camera.position.y=50;
				camera.position.z=1500;
				scene.add(camera);
				
				//light
				var light,materials;
				scene.add(new THREE.AmbientLight(0x666666));//设置环境光
				
				light=new THREE.DirectionalLight(0xdfebff, 1.75);//平行光
				light.position.set(50,200,100);
				light.position.multiplyScalar(1.3);//乘以标量1.3
				
				light.castShadow=true;
				
				light.shadowMapWidth=1024;
				light.shadowMapHeight=1024;
				
				var d=300;
				light.shadowCameraLeft=-d;
				light.shadowCameraRight=d;
				light.shadowCameraTop=d;
				light.shadowCameraBottom=-d;
				
				light.shadowCameraFar=1000;
				
				scene.add(light);
				
				
				
				//ground
				var groundTexture=THREE.ImageUtils.loadTexture("../images/grasslight-big.jpg");
				groundTexture.wrapS=groundTexture.wrapT=THREE.RepeatWrapping;
				groundTexture.repeat.set(25,25);
				groundTexture.anisotropy=16;
				
				var groundMaterial=new THREE.MeshPhongMaterial({color:0xFFFFFF,specular:0x111111,map:groundTexture});
				var mesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(20000,20000),groundMaterial);
				mesh.position.y=-250;
				mesh.rotation.x=-Math.PI/2;
				console.log(-Math.PI/2);
				mesh.receiveShadow=true;
				scene.add(mesh);
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				//render
				renderer=new THREE.WebGLRenderer({antialias:true});
				renderer.setPixelRatio(window.devicePixelRatio);//设置设备像素比
				renderer.setSize(window.innerWidth,window.innerHeight);
				renderer.setClearColor(scene.fog.color);
				
				container.appendChild(renderer.domElement);
				
				renderer.gammaInput=true;
				renderer.gammaOutput=true;
				
				renderer.shadowMap.enabled=true;
				
				window.addEventListener('resize',onWindowResize,false);
				
				//sphere.visible=!true;
				
			}
			
			function onWindowResize(){
				camera.aspect=window.innerWidth/window.innerHeight;
				camera.updateProjectionMatrix();
				
				renderer.setSize(window.innerWidth,window.innerHeight);
			}
			
			function animate(){
				requestAnimationFrame( animate );
				render();
			}
			
			
			function render(){
				
				camera.lookAt(scene.position);
				renderer.render(scene,camera);
			}
		</script>
	</body>
</html>
